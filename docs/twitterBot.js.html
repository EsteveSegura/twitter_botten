<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: twitterBot.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: twitterBot.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>require('dotenv').config();
const twit = require('twit');
const tweet = require('./tweet');

/**
 * Class that handles all bot actions
 */
class Bot {
    
    /**
     * @author GiR
     * @constructor
     * @param  {string} consumer_key - twitter credentials
     * @param  {string} consumer_secret - twitter credentials
     * @param  {string} access_token - twitter credentials
     * @param  {string} access_token_secret - twitter credentials
     */
    constructor(consumer_key, consumer_secret, access_token, access_token_secret) {
        this.T = new twit({
            consumer_key: consumer_key,
            consumer_secret: consumer_secret,
            access_token: access_token,
            access_token_secret: access_token_secret
        });
    }

    /**
     * Sleep 'x' seconds to continue with async/await actions
     * @Author GiR
     * @param  {number} secods 
     */
    sleep(secods) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve(true)
            }, 1000 * s || 1);
        });
    }

    /**
     * This methods returns a search on twitter looking for specific text
     * @author GiR
     * @param  {string} textToSearch
     * @param  {number} count
     * @returns {tweet[]} return array of tweets
     */
    searchUsersByExactTextInTweet(textToSearch, count) {
        return new Promise(async (resolve, reject) => {
            let foundTweets = []
            let twitterAction = await this.T.get('search/tweets', { q: '"' + textToSearch + '"', lang: 'es', count: count || 100 }, function (err, data, response) {
                for (let i = 0; i &lt; data.statuses.length; i++) {
                    if (!data.statuses[i].in_reply_to_status_id &amp;&amp; !data.statuses[i].retweeted &amp;&amp; !data.statuses[i].text.startsWith('RT')) {
                        let actualTweet = new tweet(data.statuses[i].user.screen_name, data.statuses[i].text, data.statuses[i].id_str)
                        foundTweets.push(actualTweet);
                    }
                }
                resolve(foundTweets);
            });
        });
    }

    /**
     * This method allows us to upload an image to our timeline
     * @author GiR
     * @param  {string} textToPost
     * @param  {string} imagePath
     */
    uploadImage(textToPost, imagePath) {
        //Encoding image to Base64
        let b64content = fs.readFileSync(imagePath, { encoding: 'base64' })

        //Creating resource in the server
        this.T.post('media/upload', { media_data: b64content }, function (err, data, response) {
            let mediaIdStr = data.media_id_string
            let meta_params = { 'media_id': mediaIdStr }

            //Creating metadata for image
            this.T.post('media/metadata/create', meta_params, (err, data, response) => {
                if (!err) {
                    let params = { 'status': textToPost, media_ids: [mediaIdStr] }
                    //Creating the tweet
                    this.T.post('statuses/update', params, (err, data, response) => {
                        console.log('Image Uploaded!');
                    });
                }
            });
        });
    }

    /**
     * Answer easyli a tweet
     * @author GiR
     * @param  {tweet} tweetObject - objectTweet for answering
     */
    answerSadPeople(tweetObject) {
        this.T.post('statuses/update', { in_reply_to_status_id: tweetObject.getTweetId(), status: `@${tweetObject.getUser()} Te diria que lo entiendo, pero soy un BOT. Animate.` }, (err, data, response) => { })
    }


}

(async () => {

    let mybot = new Bot(process.env.CONSUMER_KEY, process.env.CONSUMER_SECRET, process.env.ACCESS_TOKEN, process.env.ACCESS_TOKEN_SECRET)

    let tweets = await mybot.searchUsersByExactTextInTweet('que dia de mierda', 100)
    await mybot.answerSadPeople(tweets[0])
    //console.log(tweets)
    for (let i = 0; i &lt; tweets.length; i++) {
        console.log(`-${tweets[i].getText()}`)
    }
})();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Bot.html">Bot</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Tue Apr 28 2020 20:39:20 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
